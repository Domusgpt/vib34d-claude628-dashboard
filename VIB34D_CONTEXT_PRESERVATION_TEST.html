<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>VIB34D Context Preservation Architecture Test</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n        \n        body {\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);\n            color: #ffffff;\n            min-height: 100vh;\n            overflow-x: hidden;\n        }\n        \n        .test-container {\n            max-width: 1200px;\n            margin: 0 auto;\n            padding: 20px;\n        }\n        \n        .test-header {\n            text-align: center;\n            margin-bottom: 40px;\n            padding: 20px;\n            border: 2px solid #00ffff;\n            border-radius: 10px;\n            background: rgba(0, 255, 255, 0.1);\n        }\n        \n        .test-section {\n            margin-bottom: 30px;\n            padding: 20px;\n            border: 1px solid #333;\n            border-radius: 8px;\n            background: rgba(255, 255, 255, 0.05);\n        }\n        \n        .test-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n            gap: 20px;\n            margin-top: 20px;\n        }\n        \n        .test-card {\n            padding: 15px;\n            border: 1px solid #555;\n            border-radius: 6px;\n            background: rgba(0, 0, 0, 0.3);\n        }\n        \n        .test-button {\n            padding: 10px 20px;\n            margin: 5px;\n            border: none;\n            border-radius: 5px;\n            background: linear-gradient(45deg, #ff00ff, #00ffff);\n            color: white;\n            cursor: pointer;\n            font-weight: bold;\n            transition: all 0.3s ease;\n        }\n        \n        .test-button:hover {\n            transform: scale(1.05);\n            box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);\n        }\n        \n        .test-button.active {\n            background: linear-gradient(45deg, #00ff00, #ffff00);\n            box-shadow: 0 0 15px rgba(0, 255, 0, 0.7);\n        }\n        \n        .status-indicator {\n            display: inline-block;\n            width: 12px;\n            height: 12px;\n            border-radius: 50%;\n            margin-right: 10px;\n        }\n        \n        .status-success { background: #00ff00; }\n        .status-warning { background: #ffff00; }\n        .status-error { background: #ff0000; }\n        .status-pending { background: #888; }\n        \n        .metrics-display {\n            font-family: 'Courier New', monospace;\n            background: rgba(0, 0, 0, 0.5);\n            padding: 15px;\n            border-radius: 5px;\n            border-left: 4px solid #00ffff;\n        }\n        \n        .log-output {\n            background: #000;\n            color: #00ff00;\n            padding: 15px;\n            border-radius: 5px;\n            font-family: 'Courier New', monospace;\n            height: 200px;\n            overflow-y: auto;\n            border: 1px solid #333;\n        }\n        \n        .hypercube-faces {\n            display: grid;\n            grid-template-columns: repeat(4, 1fr);\n            gap: 10px;\n        }\n        \n        .hypercube-face {\n            padding: 20px;\n            text-align: center;\n            border: 2px solid #333;\n            border-radius: 8px;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            background: rgba(255, 255, 255, 0.05);\n        }\n        \n        .hypercube-face:hover {\n            border-color: #00ffff;\n            background: rgba(0, 255, 255, 0.1);\n        }\n        \n        .hypercube-face.active {\n            border-color: #ff00ff;\n            background: rgba(255, 0, 255, 0.2);\n            box-shadow: 0 0 20px rgba(255, 0, 255, 0.3);\n        }\n        \n        .parameter-slider {\n            width: 100%;\n            margin: 10px 0;\n        }\n        \n        .role-grid {\n            display: grid;\n            grid-template-columns: repeat(3, 1fr);\n            gap: 10px;\n            margin-top: 15px;\n        }\n        \n        .role-card {\n            padding: 10px;\n            border: 1px solid #444;\n            border-radius: 4px;\n            background: rgba(0, 0, 0, 0.2);\n            text-align: center;\n            cursor: pointer;\n            transition: all 0.2s ease;\n        }\n        \n        .role-card:hover {\n            background: rgba(255, 255, 255, 0.1);\n            border-color: #00ffff;\n        }\n        \n        .role-card.tested {\n            border-color: #00ff00;\n            background: rgba(0, 255, 0, 0.1);\n        }\n    </style>\n</head>\n<body>\n    <div class=\"test-container\">\n        <div class=\"test-header\">\n            <h1>üß† VIB34D Context Preservation Architecture Test</h1>\n            <p>Comprehensive testing of bulletproof context preservation, state management, and hypercube navigation</p>\n            <div class=\"status-display\" id=\"overallStatus\">\n                <span class=\"status-indicator status-pending\"></span>\n                <span>Initializing test environment...</span>\n            </div>\n        </div>\n        \n        <!-- Hypercube Faces Test -->\n        <div class=\"test-section\">\n            <h2>üîÆ Hypercube Faces Navigation (0-7)</h2>\n            <p>Test all 8 hypercube faces with enhanced section support and context preservation</p>\n            <div class=\"hypercube-faces\" id=\"hypercubeFaces\">\n                <!-- Generated dynamically -->\n            </div>\n            <div class=\"test-card\">\n                <h4>Current Face Info:</h4>\n                <div id=\"currentFaceInfo\">No face selected</div>\n            </div>\n        </div>\n        \n        <!-- Instance Roles Test -->\n        <div class=\"test-section\">\n            <h2>üé≠ Instance Roles Test</h2>\n            <p>Test all enhanced instance roles including board, bezel, and new roles</p>\n            <div class=\"role-grid\" id=\"roleGrid\">\n                <!-- Generated dynamically -->\n            </div>\n            <div class=\"test-card\">\n                <h4>Role Parameters:</h4>\n                <div id=\"roleParameters\">Select a role to see parameters</div>\n            </div>\n        </div>\n        \n        <!-- Context Manager Test -->\n        <div class=\"test-section\">\n            <h2>üíæ Context Manager Operations</h2>\n            <div class=\"test-grid\">\n                <div class=\"test-card\">\n                    <h4>Cache Operations</h4>\n                    <button class=\"test-button\" onclick=\"testCacheOperations()\">Test Cache</button>\n                    <button class=\"test-button\" onclick=\"clearAllCache()\">Clear Cache</button>\n                    <button class=\"test-button\" onclick=\"forceStateSave()\">Force Save</button>\n                </div>\n                <div class=\"test-card\">\n                    <h4>State Persistence</h4>\n                    <button class=\"test-button\" onclick=\"testStatePersistence()\">Test Persistence</button>\n                    <button class=\"test-button\" onclick=\"simulatePageReload()\">Simulate Reload</button>\n                </div>\n                <div class=\"test-card\">\n                    <h4>Preloading</h4>\n                    <button class=\"test-button\" onclick=\"testPreloading()\">Test Preloading</button>\n                    <button class=\"test-button\" onclick=\"testAdjacentFaces()\">Adjacent Faces</button>\n                </div>\n            </div>\n        </div>\n        \n        <!-- Performance Metrics -->\n        <div class=\"test-section\">\n            <h2>üìä Performance Metrics</h2>\n            <div class=\"metrics-display\" id=\"metricsDisplay\">\n                Loading metrics...\n            </div>\n            <button class=\"test-button\" onclick=\"refreshMetrics()\">Refresh Metrics</button>\n            <button class=\"test-button\" onclick=\"toggleDebugMode()\">Toggle Debug</button>\n        </div>\n        \n        <!-- Parameter Testing -->\n        <div class=\"test-section\">\n            <h2>üéõÔ∏è Parameter Relationship Testing</h2>\n            <div class=\"test-grid\">\n                <div class=\"test-card\">\n                    <h4>Master Parameters</h4>\n                    <label>Intensity: <span id=\"intensityValue\">0.8</span></label>\n                    <input type=\"range\" class=\"parameter-slider\" id=\"intensitySlider\" min=\"0\" max=\"1\" step=\"0.1\" value=\"0.8\">\n                    \n                    <label>Speed: <span id=\"speedValue\">1.0</span></label>\n                    <input type=\"range\" class=\"parameter-slider\" id=\"speedSlider\" min=\"0\" max=\"2\" step=\"0.1\" value=\"1.0\">\n                    \n                    <label>Density: <span id=\"densityValue\">1.0</span></label>\n                    <input type=\"range\" class=\"parameter-slider\" id=\"densitySlider\" min=\"0\" max=\"2\" step=\"0.1\" value=\"1.0\">\n                </div>\n                <div class=\"test-card\">\n                    <h4>Context Preservation</h4>\n                    <div id=\"parameterHistory\">No parameter changes yet</div>\n                </div>\n            </div>\n        </div>\n        \n        <!-- Test Log -->\n        <div class=\"test-section\">\n            <h2>üìã Test Log</h2>\n            <div class=\"log-output\" id=\"testLog\"></div>\n            <button class=\"test-button\" onclick=\"clearLog()\">Clear Log</button>\n            <button class=\"test-button\" onclick=\"runFullTest()\">Run Full Test Suite</button>\n        </div>\n    </div>\n    \n    <!-- Load VIB3 Components -->\n    <script src=\"./core/VIB34DContextManager.js\"></script>\n    <script src=\"./core/VIB3HomeMaster.js\"></script>\n    \n    <script>\n        let vib3HomeMaster = null;\n        let contextManager = null;\n        let testResults = {\n            facesTest: false,\n            rolesTest: false,\n            cacheTest: false,\n            persistenceTest: false,\n            preloadingTest: false\n        };\n        \n        // Initialize test environment\n        async function initializeTest() {\n            try {\n                logMessage('üöÄ Initializing VIB34D Context Preservation Test...');\n                \n                // Initialize VIB3HomeMaster\n                vib3HomeMaster = new VIB3HomeMaster();\n                window.vib3HomeMaster = vib3HomeMaster;\n                \n                // Wait for context manager to initialize\n                await new Promise(resolve => setTimeout(resolve, 1000));\n                \n                contextManager = vib3HomeMaster.contextManager;\n                if (contextManager) {\n                    contextManager.setDebugMode(true);\n                    logMessage('‚úÖ Context Manager initialized successfully');\n                } else {\n                    logMessage('‚ö†Ô∏è Context Manager not available - some tests will be skipped');\n                }\n                \n                // Initialize UI components\n                initializeHypercubeFaces();\n                initializeRoleGrid();\n                initializeParameterSliders();\n                \n                // Update status\n                updateOverallStatus('success', 'Test environment initialized successfully');\n                \n                // Start metrics refresh\n                setInterval(refreshMetrics, 5000);\n                \n                logMessage('‚úÖ Test environment ready!');\n                \n            } catch (error) {\n                logMessage(`‚ùå Failed to initialize test environment: ${error.message}`);\n                updateOverallStatus('error', 'Initialization failed');\n            }\n        }\n        \n        // Initialize hypercube faces UI\n        function initializeHypercubeFaces() {\n            const container = document.getElementById('hypercubeFaces');\n            const sectionNames = [\n                'HOME (Hypercube)', 'TECH (Tetrahedron)', 'MEDIA (Sphere)', 'AUDIO (Torus)',\n                'QUANTUM (Wave)', 'CONTEXT (Crystal)', 'INNOVATION (Fractal)', 'SYNTHESIS (Klein)'\n            ];\n            \n            for (let i = 0; i < 8; i++) {\n                const face = document.createElement('div');\n                face.className = 'hypercube-face';\n                face.textContent = `${i}: ${sectionNames[i]}`;\n                face.onclick = () => testFaceTransition(i);\n                container.appendChild(face);\n            }\n            \n            // Mark current face as active\n            updateActiveFace(0);\n        }\n        \n        // Initialize role grid UI\n        function initializeRoleGrid() {\n            const container = document.getElementById('roleGrid');\n            const roles = [\n                'background', 'shadow', 'content', 'highlight', 'accent',\n                'board', 'bezel', 'frame', 'glow', 'particle', 'card'\n            ];\n            \n            roles.forEach(role => {\n                const roleCard = document.createElement('div');\n                roleCard.className = 'role-card';\n                roleCard.textContent = role;\n                roleCard.onclick = () => testRoleParameters(role);\n                container.appendChild(roleCard);\n            });\n        }\n        \n        // Initialize parameter sliders\n        function initializeParameterSliders() {\n            ['intensity', 'speed', 'density'].forEach(param => {\n                const slider = document.getElementById(`${param}Slider`);\n                const valueDisplay = document.getElementById(`${param}Value`);\n                \n                slider.oninput = (e) => {\n                    const value = parseFloat(e.target.value);\n                    valueDisplay.textContent = value.toFixed(1);\n                    testParameterChange(param, value);\n                };\n            });\n        }\n        \n        // Test face transition\n        function testFaceTransition(faceIndex) {\n            try {\n                logMessage(`üîÑ Testing transition to face ${faceIndex}`);\n                \n                if (vib3HomeMaster) {\n                    vib3HomeMaster.transitionToSection(faceIndex);\n                    updateActiveFace(faceIndex);\n                    updateCurrentFaceInfo(faceIndex);\n                    testResults.facesTest = true;\n                    logMessage(`‚úÖ Successfully transitioned to face ${faceIndex}`);\n                } else {\n                    throw new Error('VIB3HomeMaster not initialized');\n                }\n                \n            } catch (error) {\n                logMessage(`‚ùå Face transition failed: ${error.message}`);\n            }\n        }\n        \n        // Test role parameters\n        function testRoleParameters(role) {\n            try {\n                logMessage(`üé≠ Testing role: ${role}`);\n                \n                if (vib3HomeMaster) {\n                    const currentSection = vib3HomeMaster.masterState.activeSection;\n                    const params = vib3HomeMaster.getInstanceParameters(currentSection, role);\n                    \n                    document.getElementById('roleParameters').innerHTML = `\n                        <strong>${role.toUpperCase()} Parameters:</strong><br>\n                        ${JSON.stringify(params, null, 2).replace(/\\n/g, '<br>').replace(/ /g, '&nbsp;')}\n                    `;\n                    \n                    // Mark role as tested\n                    const roleCards = document.querySelectorAll('.role-card');\n                    roleCards.forEach(card => {\n                        if (card.textContent === role) {\n                            card.classList.add('tested');\n                        }\n                    });\n                    \n                    testResults.rolesTest = true;\n                    logMessage(`‚úÖ Role ${role} parameters retrieved successfully`);\n                } else {\n                    throw new Error('VIB3HomeMaster not initialized');\n                }\n                \n            } catch (error) {\n                logMessage(`‚ùå Role test failed for ${role}: ${error.message}`);\n            }\n        }\n        \n        // Test parameter changes\n        function testParameterChange(paramName, value) {\n            try {\n                if (vib3HomeMaster) {\n                    // Update master state\n                    switch (paramName) {\n                        case 'intensity':\n                            vib3HomeMaster.masterState.intensity = value;\n                            break;\n                        case 'speed':\n                            vib3HomeMaster.masterState.speed = value;\n                            break;\n                        case 'density':\n                            vib3HomeMaster.masterState.density = value;\n                            break;\n                    }\n                    \n                    // Trigger parameter change event\n                    if (contextManager) {\n                        contextManager.handleParameterChange({\n                            parameterId: paramName,\n                            oldValue: null,\n                            newValue: value,\n                            source: 'slider',\n                            timestamp: Date.now()\n                        });\n                    }\n                    \n                    logMessage(`üìä Parameter ${paramName} changed to ${value}`);\n                } \n            } catch (error) {\n                logMessage(`‚ùå Parameter change failed: ${error.message}`);\n            }\n        }\n        \n        // Test cache operations\n        function testCacheOperations() {\n            try {\n                logMessage('üíæ Testing cache operations...');\n                \n                if (contextManager) {\n                    // Test caching parameters\n                    const testParams = {\n                        intensity: 0.5,\n                        speed: 1.2,\n                        density: 0.8,\n                        testTimestamp: Date.now()\n                    };\n                    \n                    contextManager.cacheParameters(0, 1, 'test', testParams);\n                    const retrieved = contextManager.getCachedParameters(0, 1, 'test');\n                    \n                    if (retrieved && retrieved.testTimestamp === testParams.testTimestamp) {\n                        testResults.cacheTest = true;\n                        logMessage('‚úÖ Cache operations working correctly');\n                    } else {\n                        throw new Error('Cache retrieval failed');\n                    }\n                } else {\n                    throw new Error('Context Manager not available');\n                }\n                \n            } catch (error) {\n                logMessage(`‚ùå Cache test failed: ${error.message}`);\n            }\n        }\n        \n        // Test state persistence\n        function testStatePersistence() {\n            try {\n                logMessage('üíæ Testing state persistence...');\n                \n                if (contextManager) {\n                    contextManager.saveCurrentState();\n                    testResults.persistenceTest = true;\n                    logMessage('‚úÖ State persistence test completed');\n                } else {\n                    throw new Error('Context Manager not available');\n                }\n                \n            } catch (error) {\n                logMessage(`‚ùå Persistence test failed: ${error.message}`);\n            }\n        }\n        \n        // Test preloading\n        function testPreloading() {\n            try {\n                logMessage('üîÑ Testing intelligent preloading...');\n                \n                if (contextManager) {\n                    contextManager.preloadAdjacentFaces(2); // Preload around face 2\n                    testResults.preloadingTest = true;\n                    logMessage('‚úÖ Preloading test completed');\n                } else {\n                    throw new Error('Context Manager not available');\n                }\n                \n            } catch (error) {\n                logMessage(`‚ùå Preloading test failed: ${error.message}`);\n            }\n        }\n        \n        // Utility functions\n        function updateActiveFace(faceIndex) {\n            const faces = document.querySelectorAll('.hypercube-face');\n            faces.forEach((face, index) => {\n                face.classList.toggle('active', index === faceIndex);\n            });\n        }\n        \n        function updateCurrentFaceInfo(faceIndex) {\n            if (vib3HomeMaster && vib3HomeMaster.sectionModifiers[faceIndex]) {\n                const section = vib3HomeMaster.sectionModifiers[faceIndex];\n                document.getElementById('currentFaceInfo').innerHTML = `\n                    <strong>Face ${faceIndex}: ${section.name}</strong><br>\n                    Geometry: ${section.geometryThemeName}<br>\n                    Intensity Mod: ${section.intensityMod}<br>\n                    Speed Mod: ${section.speedMod}<br>\n                    Density Mod: ${section.densityMod}\n                `;\n            }\n        }\n        \n        function refreshMetrics() {\n            if (contextManager) {\n                const metrics = contextManager.getMetrics();\n                document.getElementById('metricsDisplay').innerHTML = `\n                    Cache Size: ${metrics.cacheSize || 0}<br>\n                    Cache Hits: ${metrics.cacheHits || 0}<br>\n                    Cache Misses: ${metrics.cacheMisses || 0}<br>\n                    Hit Rate: ${((metrics.hitRate || 0) * 100).toFixed(1)}%<br>\n                    State Restorations: ${metrics.stateRestorations || 0}<br>\n                    Preload Success Rate: ${((metrics.preloadSuccessRate || 0) * 100).toFixed(1)}%\n                `;\n            } else {\n                document.getElementById('metricsDisplay').innerHTML = 'Context Manager not available';\n            }\n        }\n        \n        function logMessage(message) {\n            const log = document.getElementById('testLog');\n            const timestamp = new Date().toLocaleTimeString();\n            log.innerHTML += `[${timestamp}] ${message}\\n`;\n            log.scrollTop = log.scrollHeight;\n        }\n        \n        function clearLog() {\n            document.getElementById('testLog').innerHTML = '';\n        }\n        \n        function updateOverallStatus(type, message) {\n            const statusElement = document.getElementById('overallStatus');\n            const indicator = statusElement.querySelector('.status-indicator');\n            const text = statusElement.querySelector('span:last-child');\n            \n            indicator.className = `status-indicator status-${type}`;\n            text.textContent = message;\n        }\n        \n        function clearAllCache() {\n            if (contextManager) {\n                contextManager.clearCache();\n                logMessage('üóëÔ∏è All cache cleared');\n            }\n        }\n        \n        function forceStateSave() {\n            if (vib3HomeMaster) {\n                vib3HomeMaster.saveCurrentState();\n                logMessage('üíæ State saved manually');\n            }\n        }\n        \n        function toggleDebugMode() {\n            if (vib3HomeMaster) {\n                const currentMode = contextManager && contextManager.config.debugMode;\n                vib3HomeMaster.enableContextDebug(!currentMode);\n                logMessage(`üêõ Debug mode ${!currentMode ? 'enabled' : 'disabled'}`);\n            }\n        }\n        \n        function simulatePageReload() {\n            logMessage('üîÑ Simulating page reload test...');\n            location.reload();\n        }\n        \n        function testAdjacentFaces() {\n            if (contextManager) {\n                const currentFace = vib3HomeMaster.masterState.activeSection;\n                logMessage(`üîç Testing adjacent faces for face ${currentFace}`);\n                contextManager.preloadAdjacentFaces(currentFace);\n            }\n        }\n        \n        function runFullTest() {\n            logMessage('üß™ Running full test suite...');\n            \n            setTimeout(() => testCacheOperations(), 500);\n            setTimeout(() => testStatePersistence(), 1000);\n            setTimeout(() => testPreloading(), 1500);\n            \n            // Test all faces\n            for (let i = 0; i < 8; i++) {\n                setTimeout(() => testFaceTransition(i), 2000 + i * 200);\n            }\n            \n            // Test all roles\n            const roles = ['background', 'shadow', 'content', 'highlight', 'accent', 'board', 'bezel'];\n            roles.forEach((role, index) => {\n                setTimeout(() => testRoleParameters(role), 4000 + index * 200);\n            });\n            \n            setTimeout(() => {\n                const passedTests = Object.values(testResults).filter(result => result).length;\n                const totalTests = Object.keys(testResults).length;\n                logMessage(`üìä Test Suite Complete: ${passedTests}/${totalTests} tests passed`);\n                \n                if (passedTests === totalTests) {\n                    updateOverallStatus('success', 'All tests passed!');\n                } else {\n                    updateOverallStatus('warning', `${passedTests}/${totalTests} tests passed`);\n                }\n            }, 6000);\n        }\n        \n        // Initialize when page loads\n        window.addEventListener('load', initializeTest);\n    </script>\n</body>\n</html>"